<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="OtobusBiletSistemi.Mobile.Views.BiletSahibiBilgileriPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:OtobusBiletSistemi.Mobile.ViewModels"
             xmlns:models="clr-namespace:OtobusBiletSistemi.Mobile.Models"
             xmlns:converters="clr-namespace:OtobusBiletSistemi.Mobile.Converters"
             x:DataType="viewmodels:BiletSahibiBilgileriViewModel"
             Title=""
             BackgroundColor="#667EEA"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter" />
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" BackgroundColor="#667EEA">
            <Grid Padding="20,45,20,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <Button Grid.Column="0"
                        Text="‹"
                        Command="{Binding GeriCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="28" />
                
                <Label Grid.Column="1" 
                       Text="Bilet Sahibi Bilgileri" 
                       FontSize="18" 
                       TextColor="White" 
                       HorizontalOptions="Center" />
                
                <Label Grid.Column="2"
                       Text="{Binding SayfaBilgisi}"
                       FontSize="12"
                       TextColor="White" />
            </Grid>
        </StackLayout>

        <!-- Content -->
        <ScrollView Grid.Row="1" Padding="20">
            <Frame BackgroundColor="White" CornerRadius="25" Padding="25">
                <StackLayout Spacing="20" BindingContext="{Binding MevcutBiletSahibi}" x:DataType="models:BiletSahibi">
                    
                    <Label Text="{Binding KoltukNo, StringFormat='Koltuk: {0}'}" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           HorizontalOptions="Center" />
                    
                    <Entry Text="{Binding Ad}" Placeholder="Ad" />
                    <Entry Text="{Binding Soyad}" Placeholder="Soyad" />
                    <Entry Text="{Binding TcKimlikNo}" 
                           Placeholder="TC Kimlik No" 
                           Keyboard="Numeric" 
                           MaxLength="11" />
                    
                    <!-- TC Kimlik Hata Mesajı -->
                    <Label Text="{Binding TcKimlikHataMesaji}"
                           TextColor="Red"
                           FontSize="12"
                           IsVisible="{Binding TcKimlikHataMesaji, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                           Margin="5,0,0,0" />
                    <Entry Text="{Binding Telefon}" 
                           Placeholder="Telefon" 
                           Keyboard="Telephone" />
                    <Entry Text="{Binding Email}" 
                           Placeholder="E-posta" 
                           Keyboard="Email" />
                    
                </StackLayout>
            </Frame>
        </ScrollView>

        <!-- Bottom -->
        <StackLayout Grid.Row="2" Padding="20">
            <!-- Navigation Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" 
                  IsVisible="{Binding BiletSahipleri.Count, Converter={StaticResource IntToGreaterThanOneConverter}}">
                <Button Grid.Column="0"
                        Text="Önceki"
                        Command="{Binding OncekiBiletSahibiCommand}"
                        IsEnabled="{Binding CanGoPrevious}"
                        BackgroundColor="#95A5A6"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="45" />
                <Button Grid.Column="1"
                        Text="{Binding NextButtonText}"
                        Command="{Binding SonrakiBiletSahibiCommand}"
                        IsEnabled="{Binding CanGoNext}"
                        BackgroundColor="#3498DB"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="45" />
            </Grid>
            
            <!-- Payment Button -->
            <Button Text="Ödemeye Devam Et"
                    Command="{Binding OdemeDevamEtCommand}"
                    IsVisible="{Binding ShowPaymentButton}"
                    IsEnabled="{Binding MevcutBiletSahibi.IsValid}"
                    BackgroundColor="#667EEA"
                    TextColor="White"
                    CornerRadius="25"
                    HeightRequest="55"
                    FontSize="16"
                    FontAttributes="Bold"
                    Margin="0,10,0,0">
                <Button.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#667EEA" Offset="0.0" />
                        <GradientStop Color="#764BA2" Offset="1.0" />
                    </LinearGradientBrush>
                </Button.Background>
            </Button>
            
            <!-- Show current passenger validation status -->
            <Label Text="Lütfen tüm bilgileri eksiksiz doldurun"
                   TextColor="Orange"
                   FontSize="12"
                   HorizontalOptions="Center"
                   IsVisible="{Binding MevcutBiletSahibi.IsValid, Converter={StaticResource InvertedBoolConverter}}"
                   Margin="0,5,0,0" />
                   
        </StackLayout>

    </Grid>

</ContentPage> 