<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="OtobusBiletSistemi.Mobile.Views.KoltukSecimPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:OtobusBiletSistemi.Mobile.ViewModels"
             xmlns:local="clr-namespace:OtobusBiletSistemi.Mobile.Models"
             xmlns:converters="clr-namespace:OtobusBiletSistemi.Mobile.Converters"
             x:DataType="viewmodels:KoltukSecimViewModel"
             Title=""
             BackgroundColor="#667EEA"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False"
             NavigationPage.HasNavigationBar="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
            <converters:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" BackgroundColor="#667EEA" Spacing="0">
            
            <!-- Top Navigation -->
            <Grid BackgroundColor="#667EEA" Padding="20,45,20,20">
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#667EEA" Offset="0.0" />
                        <GradientStop Color="#764BA2" Offset="1.0" />
                    </LinearGradientBrush>
                </Grid.Background>
                
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <!-- Back Button -->
                <Button Grid.Column="0"
                        Text="â€¹"
                        Command="{Binding GeriCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="28"
                        WidthRequest="35"
                        HeightRequest="35" />
                
                <!-- Page Title -->
                <Label Grid.Column="1" 
                       Text="Koltuk SeÃ§imi" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
                
                <!-- Selection Count -->
                <Frame Grid.Column="2"
                       BackgroundColor="DeepSkyBlue"
                       CornerRadius="12"
                       Padding="10,5"
                       HasShadow="False">
                    <Label Text="{Binding SecilenKoltuklar.Count, StringFormat='{0} seÃ§ili'}"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="White" />
                </Frame>
            </Grid>
            
            <!-- Journey Info Card -->
            <Frame BackgroundColor="White" 
                   CornerRadius="0,0,20,20"
                   Padding="20,15,20,20"
                   HasShadow="True"
                   Margin="0,-15,0,0">
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <!-- Route Info -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <!-- Departure -->
                        <StackLayout Grid.Column="0" HorizontalOptions="Start" Margin="15,0,0,0">
                            <Label Text="{Binding KalkisYeri}" 
                                   FontSize="18" 
                                   FontAttributes="Bold"
                                   TextColor="#2C3E50" />
                            <Label Text="{Binding KalkisSaati, StringFormat='{0:HH:mm}'}" 
                                   FontSize="14" 
                                   TextColor="#7F8C8D" />
                        </StackLayout>
                        
                        <!-- Route Icon -->
                        <StackLayout Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Center">
                            <Label Text="ðŸšŒ" FontSize="20" HorizontalOptions="Center" />
                            <BoxView HeightRequest="2" 
                                     WidthRequest="40" 
                                     BackgroundColor="#667EEA" 
                                     CornerRadius="1" />
                        </StackLayout>
                        
                        <!-- Arrival -->
                        <StackLayout Grid.Column="2" HorizontalOptions="End" Margin="0,0,15,0">
                            <Label Text="{Binding VarisYeri}" 
                                   FontSize="18" 
                                   FontAttributes="Bold"
                                   TextColor="#2C3E50" />
                            <Label Text="{Binding VarisSaati, StringFormat='{0:HH:mm}'}" 
                                   FontSize="14" 
                                   TextColor="#7F8C8D" />
                        </StackLayout>
                    </Grid>
                    
                    <!-- Date and Selection Info -->
                    <StackLayout Grid.Row="1" 
                               Orientation="Horizontal" 
                               HorizontalOptions="Center"
                               Spacing="20"
                               Margin="0,15,0,0">
                        
                        <Frame BackgroundColor="#F8FAFF"
                               CornerRadius="12"
                               Padding="12,8"
                               HasShadow="False">
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Label Text="ðŸ“…" FontSize="14" VerticalOptions="Center" />
                                <Label Text="{Binding SeferTarihi, StringFormat='{0:dd MMM yyyy}'}" 
                                       FontSize="13" 
                                       FontAttributes="Bold"
                                       TextColor="#667EEA"
                                       VerticalOptions="Center" />
                            </StackLayout>
                        </Frame>
                        
                        <Frame BackgroundColor="#F8FAFF"
                               CornerRadius="12"
                               Padding="12,8"
                               HasShadow="False">
                            <StackLayout Orientation="Horizontal" Spacing="8">
                                <Label Text="ðŸŽ«" FontSize="14" VerticalOptions="Center" />
                                <Label Text="{Binding SelectionHint}" 
                                       FontSize="13" 
                                       FontAttributes="Bold"
                                       TextColor="#667EEA"
                                       VerticalOptions="Center" />
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                </Grid>
            </Frame>
            
        </StackLayout>

        <!-- Content -->
        <ScrollView Grid.Row="1" Padding="20">
            <StackLayout Spacing="20">
                
                <!-- Bus Layout -->
                <Frame BackgroundColor="White" 
                       CornerRadius="25" 
                       Padding="25"
                       HasShadow="True">
                    
                    <StackLayout Spacing="20">
                        <!-- Title -->
                        <Label Text="Koltuk PlanÄ±" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="#2C3E50"
                               HorizontalOptions="Center" />
                        
                        <!-- Loading -->
                        <ActivityIndicator IsVisible="{Binding IsLoading}" 
                                         IsRunning="{Binding IsLoading}"
                                         Color="#667EEA"
                                         HeightRequest="50" />
                        
                        <!-- Error Message -->
                        <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                               BackgroundColor="#FFE6E6"
                               CornerRadius="15"
                               Padding="15"
                               HasShadow="False">
                            <Label Text="{Binding ErrorMessage}"
                                   TextColor="#DC3545"
                                   FontSize="14"
                                   HorizontalOptions="Center" />
                        </Frame>
                        
                        <!-- Bus Layout -->
                        <StackLayout IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                                   Spacing="15">
                            
                            <!-- Driver Section -->
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                
                                <Frame Grid.Column="0"
                                       BackgroundColor="#2C3E50"
                                       CornerRadius="10"
                                       Padding="8"
                                       HeightRequest="35"
                                       WidthRequest="50"
                                       HasShadow="False">
                                    <Label Text="ÅžOFÃ–R" 
                                           FontSize="10" 
                                           FontAttributes="Bold"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Frame>
                            </Grid>
                            
                            <!-- Seat Rows -->
                            <CollectionView ItemsSource="{Binding KoltukRows}"
                                          BackgroundColor="Transparent">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="viewmodels:KoltukRow">
                                        <Grid Margin="0,5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="40" />   <!-- Row Number -->
                                                <ColumnDefinition Width="55" />   <!-- Seat A -->
                                                <ColumnDefinition Width="55" />   <!-- Seat B -->
                                                <ColumnDefinition Width="25" />   <!-- Aisle -->
                                                <ColumnDefinition Width="55" />   <!-- Seat C -->
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Row Number -->
                                            <Label Grid.Column="0"
                                                   Text="{Binding RowNumber}"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="#666"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                            
                                            <!-- Seat A -->
                                            <Button Grid.Column="1"
                                                    Text="{Binding SeatA.KoltukNo}"
                                                    Command="{Binding BindingContext.SelectKoltukCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                    CommandParameter="{Binding SeatA}"
                                                    BackgroundColor="{Binding SeatA.BackgroundColor}"
                                                    TextColor="{Binding SeatA.TextColor}"
                                                    IsVisible="{Binding SeatA, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                                    IsEnabled="{Binding SeatA.IsAvailable}"
                                                    CornerRadius="8"
                                                    FontSize="11"
                                                    FontAttributes="Bold"
                                                    HeightRequest="45"
                                                    WidthRequest="45" />
                                            
                                            <!-- Seat B -->
                                            <Button Grid.Column="2"
                                                    Text="{Binding SeatB.KoltukNo}"
                                                    Command="{Binding BindingContext.SelectKoltukCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                    CommandParameter="{Binding SeatB}"
                                                    BackgroundColor="{Binding SeatB.BackgroundColor}"
                                                    TextColor="{Binding SeatB.TextColor}"
                                                    IsVisible="{Binding SeatB, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                                    IsEnabled="{Binding SeatB.IsAvailable}"
                                                    CornerRadius="8"
                                                    FontSize="11"
                                                    FontAttributes="Bold"
                                                    HeightRequest="45"
                                                    WidthRequest="45" />
                                            
                                            <!-- Aisle Space -->
                                            
                                            <!-- Seat C -->
                                            <Button Grid.Column="4"
                                                    Text="{Binding SeatC.KoltukNo}"
                                                    Command="{Binding BindingContext.SelectKoltukCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                    CommandParameter="{Binding SeatC}"
                                                    BackgroundColor="{Binding SeatC.BackgroundColor}"
                                                    TextColor="{Binding SeatC.TextColor}"
                                                    IsVisible="{Binding SeatC, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                                    IsEnabled="{Binding SeatC.IsAvailable}"
                                                    CornerRadius="8"
                                                    FontSize="11"
                                                    FontAttributes="Bold"
                                                    HeightRequest="45"
                                                    WidthRequest="45" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                            
                            <!-- Legend -->
                            <StackLayout Orientation="Horizontal" 
                                       HorizontalOptions="Center"
                                       Spacing="15"
                                       Margin="0,20,0,0">
                                
                                <StackLayout Orientation="Horizontal" Spacing="5">
                                    <BoxView BackgroundColor="LightGreen" 
                                           WidthRequest="20" 
                                           HeightRequest="20" 
                                           CornerRadius="4" />
                                    <Label Text="BoÅŸ" 
                                           FontSize="12" 
                                           TextColor="#666"
                                           VerticalOptions="Center" />
                                </StackLayout>
                                
                                <StackLayout Orientation="Horizontal" Spacing="5">
                                    <BoxView BackgroundColor="Blue" 
                                           WidthRequest="20" 
                                           HeightRequest="20" 
                                           CornerRadius="4" />
                                    <Label Text="SeÃ§ili" 
                                           FontSize="12" 
                                           TextColor="#666"
                                           VerticalOptions="Center" />
                                </StackLayout>
                                
                                <StackLayout Orientation="Horizontal" Spacing="5">
                                    <BoxView BackgroundColor="Red" 
                                           WidthRequest="20" 
                                           HeightRequest="20" 
                                           CornerRadius="4" />
                                    <Label Text="Dolu" 
                                           FontSize="12" 
                                           TextColor="#666"
                                           VerticalOptions="Center" />
                                </StackLayout>
                            </StackLayout>
                            
                        </StackLayout>
                        
                    </StackLayout>
                </Frame>
                
            </StackLayout>
        </ScrollView>

        <!-- Bottom Button -->
        <Frame Grid.Row="2" 
               BackgroundColor="Transparent" 
               Padding="20,10,20,20"
               HasShadow="False">
            <Button Text="{Binding DevamButtonText}"
                    Command="{Binding DevamEtCommand}"
                    IsEnabled="{Binding CanContinue}"
                    BackgroundColor="#667EEA"
                    TextColor="White"
                    CornerRadius="25"
                    HeightRequest="55"
                    FontSize="16"
                    FontAttributes="Bold">
                <Button.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#667EEA" Offset="0.0" />
                        <GradientStop Color="#764BA2" Offset="1.0" />
                    </LinearGradientBrush>
                </Button.Background>
            </Button>
        </Frame>

    </Grid>

</ContentPage>
